const a2020prefs=JSON.parse(a2020_content_ajax.a2020_content_prefs),wpteams={data:()=>({loading:!0,upload:!1,masterLoader:!1,contentTable:{content:[],total:0,test:!0,currentPage:1,totalPages:1,selected:[],selectAll:!1,postTypes:[],postStatuses:[],fileTypes:[],categories:[],tags:[],mode:a2020prefs.viewMode,gridSize:a2020prefs.gridSize,folderPanel:"true"==a2020prefs.folderView,views:{allViews:[],currentView:[]},filters:{search:"",selectedPostTypes:[],selectedPostStatuses:[],selectedFileTypes:[],selectedCategories:[],selectedTags:[],date:"",dateComparison:"on",perPage:a2020prefs.perPage,activeFolder:0}},newView:{name:""},folders:{allFolders:[],openFolders:[],activeFolder:[],activeFolderObj:[],newFolder:{name:"",color:"#0c5cef",parent:""},editFolder:{name:"",color:"",id:""}},quickEdit:{id:"",title:"",status:"",author:"",created:"",modified:"",postType:"",url:"",selectedCategories:[],selectedStatus:[],selectedTags:[]},batchUpdate:{tags:[],categories:[],replaceTags:!1,replaceCats:!1},batchRename:{renameTypes:a2020prefs.renameOptions,selectedAttribute:"name",metaKey:"",selectedTypes:[],selectedOption:0,preview:[]}}),computed:{queryContent(){this.getFiles(),this.getFolders()},fileList(){return this.queryContent,this.contentTable.content}},mounted:function(){window.setInterval(()=>{},15e3),self=this,this.masterLoader=!0,jQuery.fn.filepond.registerPlugin(FilePondPluginFileEncode),jQuery.fn.filepond.registerPlugin(FilePondPluginFileValidateSize),jQuery.fn.filepond.registerPlugin(FilePondPluginImageExifOrientation),jQuery.fn.filepond.registerPlugin(FilePondPluginFileValidateType),jQuery.fn.filepond.setDefaults({acceptedFileTypes:JSON.parse(a2020_content_ajax.a2020_allowed_types),allowRevert:!1}),jQuery("#a2020_file_upload").filepond(),FilePond.setOptions({server:{url:a2020_content_ajax.ajax_url,type:"post",process:{url:"?action=a2020_process_upload&security="+a2020_content_ajax.security+"&folder="+self.folders.activeFolder[0],method:"POST",ondata:e=>(e.append("folder",self.folders.activeFolder[0]),e),onload:e=>{if(e){if(data=JSON.parse(e),data.error)return e;self.getFiles(),self.getFolders()}return e}}}})},watch:{"contentTable.filters.perPage":function(e,t){e!=t&&a2020_save_user_prefences("content_per_page",e,!1)},"contentTable.gridSize":function(e,t){e!=t&&a2020_save_user_prefences("content_grid_size",e,!1)},"contentTable.mode":function(e,t){e!=t&&a2020_save_user_prefences("content_view_mode",e,!1)}},methods:{addBatchNameOption(){selectedOption=this.batchRename.selectedOption,temp={},temp.name=selectedOption,temp.primaryValue=null,temp.secondaryValue=null,this.batchRename.selectedTypes.push(temp)},removeBatchOption(e){this.batchRename.selectedTypes.splice(e,1)},moveBatchOptionUp(e){this.array_move(this.batchRename.selectedTypes,e,e-1)},moveBatchOptionDown(e){this.array_move(this.batchRename.selectedTypes,e,e+1)},array_move(e,t,a){if(a>=e.length)for(var s=a-e.length+1;s--;)e.push(void 0);e.splice(a,0,e.splice(t,1)[0])},batchRenamePreview(){self=this,selected=this.contentTable.selected,options=self.batchRename.selectedTypes,fieldToRename=this.batchRename.selectedAttribute,metaKey=this.batchRename.metaKey,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_batch_rename_preview",security:a2020_content_ajax.security,selected:selected,batchoptions:options,fieldToRename:fieldToRename,metaKey:metaKey},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):self.batchRename.preview=data.newnames}})},batchRenameProcess(){self=this,selected=this.contentTable.selected,options=self.batchRename.selectedTypes,fieldToRename=this.batchRename.selectedAttribute,metaKey=this.batchRename.metaKey,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_process_batch_rename",security:a2020_content_ajax.security,selected:selected,batchoptions:options,fieldToRename:fieldToRename,metaKey:metaKey},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):(UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),self.getFiles(),self.batchRename.preview=[])}})},getFiles(){self=this,this.loading=!0,self.contentTable.filters.activeFolder=self.folders.activeFolder[0],searchString=self.contentTable.filters.search,page=self.contentTable.currentPage,types=self.contentTable.filters.selectedPostTypes,statuses=self.contentTable.filters.selectedPostStatuses,filters=self.contentTable.filters,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_get_content",security:a2020_content_ajax.security,searchString:searchString,page:page,types:types,statuses:statuses,filters:filters},success:function(e){if(data=JSON.parse(e),data)return self.contentTable.content=data.content,self.contentTable.total=data.total,self.contentTable.totalPages=data.totalPages,self.contentTable.postTypes=data.postTypes,self.contentTable.postStatuses=data.postStatuses,self.contentTable.fileTypes=data.fileTypes,self.contentTable.categories=data.categories,self.contentTable.tags=data.tags,self.contentTable.views.allViews=data.views,self.loading=!1,(page<1||!page||page>self.contentTable.totalPages)&&(page=1,self.contentTable.currentPage=1),self.contentTable.content}})},nameNewView(){UIkit.dropdown(".content-table-filters").hide(),UIkit.modal(" #new-view-modal").show()},getFolders(){self=this,this.loading=!0,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_get_folders",security:a2020_content_ajax.security},success:function(e){if(data=JSON.parse(e),self.loading=!1,data)return self.folders.allFolders=data,self.folders.allFolders}})},openCatsTags(){UIkit.modal("#tags-cats-modal").show()},switchFolderPanel(){this.contentTable.folderPanel=!this.contentTable.folderPanel,a2020_save_user_prefences("content_folder_view",this.contentTable.folderPanel,!1)},createFolder(){self=this,self.loading=!0,self.folders.newFolder.parent=self.folders.activeFolder[0],folders=self.folders.newFolder,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_create_folder",security:a2020_content_ajax.security,folders:folders},success:function(e){if(self.loading=!1,data=JSON.parse(e),!data.error)return data?(UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),self.folders.newFolder.name="",self.folders.newFolder.parent="",self.getFolders()):void 0;UIkit.notification(data.error,{pos:"bottom-left",status:"danger"})}})},confirmDeleteFolder(){UIkit.modal.confirm("Are you sure you want to delete this folder?").then(function(){self.deleteFolder()},function(){})},editFolder(e){self=this,self.folders.editFolder.name=e.title,self.folders.editFolder.color=e.color,self.folders.editFolder.id=e.id,jQuery("#updatefolderpanel").show()},updateFolder(){self=this,thefolder=self.folders.editFolder,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_update_folder",security:a2020_content_ajax.security,thefolder:thefolder},success:function(e){if(self.loading=!1,data=JSON.parse(e),!data.error)return data?(UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),jQuery("#updatefolderpanel").hide(),self.getFolders()):void 0;UIkit.notification(data.error,{pos:"bottom-left",status:"danger"})}})},deleteFolder(){self=this,self.loading=!0,activeFolder=self.folders.activeFolder[0],jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_delete_folder",security:a2020_content_ajax.security,activeFolder:activeFolder},success:function(e){if(self.loading=!1,data=JSON.parse(e),!data.error)return data?(UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),self.folders.activeFolder=[],self.getFolders()):void 0;UIkit.notification(data.error,{pos:"bottom-left",status:"danger"})}})},openQuickEdit(e){self=this,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_open_quick_edit",security:a2020_content_ajax.security,itemid:e},success:function(e){data=JSON.parse(e),self.quickEdit=data,UIkit.modal("#a2020-quick-edit-modal").show()}})},openImageEdit(){var e=this.quickEdit.src;self=this;var{createDefaultImageReader:t,createDefaultImageWriter:a,locale_en_gb:s,setPlugins:o,plugin_crop:l,plugin_crop_defaults:n,plugin_crop_locale_en_gb:r,plugin_filter:i,plugin_filter_defaults:d,plugin_filter_locale_en_gb:c,plugin_finetune:f,plugin_finetune_defaults:p,plugin_finetune_locale_en_gb:u,plugin_annotate:m,plugin_annotate_locale_en_gb:_,plugin_sticker:g,plugin_sticker_locale_en_gb:h,markup_editor_defaults:y,markup_editor_locale_en_gb:b}=jQuery.fn.doka;o(l,i,f,m,g),jQuery.fn.doka.openEditor({src:e,imageReader:t(),imageWriter:a(),stickers:[["Emoji",["⭐️","😊","👍","👎","☀️","🌤","🌥"]]],cropSelectPresetOptions:n.cropSelectPresetOptions,filterFunctions:d.filterFunctions,filterOptions:d.filterOptions,finetuneControlConfiguration:p.finetuneControlConfiguration,finetuneOptions:p.finetuneOptions,markupEditorToolbar:y.markupEditorToolbar,markupEditorToolStyles:y.markupEditorToolStyles,markupEditorShapeStyleControls:y.markupEditorShapeStyleControls,locale:Object.assign({},s,r,u,c,_,h,b)}).on("process",e=>self.saveEditedImage(e.dest))},saveEditedImage(e){UIkit.notification("Saving"),self=this,fd=new FormData,fd.append("ammended_image",e),fd.append("attachmentid",self.quickEdit.id),fd.append("security",a2020_content_ajax.security),fd.append("action","a2020_save_edited_image"),jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:fd,async:!0,cache:!1,contentType:!1,processData:!1,success:function(e){e&&(data=JSON.parse(e),data.error?UIkit.notification(data.error_message,"danger"):(self.quickEdit.src=data.src,UIkit.notification(data.message,"success")))},error:function(e){console.log(e)}})},updateItem(){self=this,options=self.quickEdit,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_update_item",security:a2020_content_ajax.security,options:options},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):(UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),self.quickEdit.status=data.status,self.getFiles())}})},dropInTopLevel(e){var t=e.dataTransfer.getData("itemID"),a=e.dataTransfer.getData("type");"folder"==a&&this.moveFolder(t,"toplevel"),"content"==a&&this.moveContentToFolder(t,"toplevel"),jQuery("#a2020-folder-template").hide()},moveContentToFolder(e,t){self=this,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_move_content_to_folder",security:a2020_content_ajax.security,contentID:e,destinationId:t},success:function(e){if(data=JSON.parse(e),!data.error)return UIkit.notification(data.message,{pos:"bottom-left",status:"succes"}),self.getFiles(),self.getFolders();UIkit.notification(data.error,{pos:"bottom-left",status:"danger"})}})},moveFolder(e,t){self=this,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_move_folder",security:a2020_content_ajax.security,folderiD:e,destinationId:t},success:function(e){if(data=JSON.parse(e),!data.error)return UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),self.getFolders();UIkit.notification(data.error,{pos:"bottom-left",status:"danger"})}})},startContentDrag(e,t){allSelected=this.contentTable.selected,allSelected.length>0?(e.dataTransfer.setData("itemID",JSON.stringify(allSelected)),thefiles=allSelected.length+" files"):(e.dataTransfer.setData("itemID",JSON.stringify([t.id])),thefiles="1 file"),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("type","content"),jQuery("#a2020-folder-template").show();var a=document.createElement("div");a.id="a2020Contentdrag",a.innerHTML=thefiles,a.style.position="absolute",a.style.top="-1000px",document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0)},endContentDrag(e,t){jQuery("#a2020-folder-template").hide()},selectAllTable(){self=this,!1===self.contentTable.selectAll?(self.contentTable.selected=[],self.contentTable.content.forEach(function(e,t){self.contentTable.selected.push(e.id)}),self.contentTable.selectAll=!0):(self.contentTable.selected=[],self.contentTable.selectAll=!1)},setView(e){for(var t in this.resetFilters(),this.contentTable.views.currentView=e,e.filters)this.contentTable.filters[t]=e.filters[t]},resetFilters(){this.contentTable.filters={search:"",selectedPostTypes:[],selectedPostStatuses:[],selectedFileTypes:[],selectedCategories:[],selectedTags:[],date:"",dateComparison:"on",perPage:20}},isIn:(e,t)=>t.includes(e),removeFromList(e,t){const a=t.indexOf(e);a>-1&&(t=t.splice(a,1))},totalFilters(){return total=0,total+=this.contentTable.filters.selectedPostTypes.length,total+=this.contentTable.filters.selectedPostStatuses.length,total+=this.contentTable.filters.date.length,total+=this.contentTable.filters.selectedFileTypes.length,total+=this.contentTable.filters.selectedCategories.length,total+=this.contentTable.filters.selectedTags.length,total>0},saveView(){self=this,count=this.contentTable.views.allViews.length+1,newView={name:this.newView.name,filters:this.contentTable.filters,id:count},this.contentTable.views.allViews.push(newView),this.refreshViews()},refreshViews(){allViews=this.contentTable.views.allViews,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_save_view",security:a2020_content_ajax.security,allViews:allViews},success:function(e){data=JSON.parse(e),data&&(self.loading=!1,UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),UIkit.modal("#new-view-modal").hide(),self.getFiles())}})},removeView(e){options=this.contentTable.views.allViews,newViews=[],options.forEach(function(t,a){t.id!=e.id&&newViews.push(t)}),this.contentTable.views.allViews=newViews,this.refreshViews()},duplicateItem(e){this.contentTable.selected=[e],this.duplicateMultiple()},duplicateMultiple(){self=this,selected=this.contentTable.selected,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_duplicate_selected",security:a2020_content_ajax.security,selected:selected},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):(totaldeleted=parseInt(data.deleted_total),totaldeleted>0&&UIkit.notification(data.deleted_total+" "+data.deleted_message,{pos:"bottom-left",status:"success"}),totalfailed=parseInt(data.failed_total),totalfailed>0&&UIkit.notification(data.failed_total+" "+data.failed_message,{pos:"bottom-left",status:"warning"}),self.contentTable.selected=[],self.getFiles())}})},batchUpdateTagsCats(){self=this,selected=this.contentTable.selected,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_batch_tags_cats",security:a2020_content_ajax.security,selected:selected,theTags:self.batchUpdate},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):(UIkit.notification(data.message,{pos:"bottom-left",status:"success"}),self.contentTable.selected=[],UIkit.modal("#tags-cats-modal").hide())}})},deleteItem(e){this.contentTable.selected=[e],this.deleteMultiple()},deleteMultiple(){selected=this.contentTable.selected,UIkit.modal.confirm("Are you sure you want to delete "+selected.length+" items?").then(function(){self.deleteSelected()},function(){})},deleteSelected(){self=this,selected=this.contentTable.selected,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_delete_selected",security:a2020_content_ajax.security,selected:selected},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):(totaldeleted=parseInt(data.deleted_total),totaldeleted>0&&UIkit.notification(data.deleted_total+" "+data.deleted_message,{pos:"bottom-left",status:"success"}),totalfailed=parseInt(data.failed_total),totalfailed>0&&UIkit.notification(data.failed_total+" "+data.failed_message,{pos:"bottom-left",status:"warning"}),self.contentTable.selected=[],self.getFiles())}})}}},contentPageApp=a2020Vue.createApp(wpteams);contentPageApp.component("multi-select",{data:function(){return{thisSearchInput:""}},props:{options:Array,selected:Array,name:String,placeholder:String,single:Boolean},methods:{addSelected(e,t){1==this.single?t[0]=e:t.push(e)},removeSelected(e,t){const a=t.indexOf(e);a>-1&&(t=t.splice(a,1))},ifSelected:(e,t)=>!(t.indexOf(e)>-1),ifInSearch:(e,t)=>(item=e.toLowerCase(),string=t.toLowerCase(),!!item.includes(string))},template:'<div class="a2020-select-container"> \t  <div class=" uk-flex uk-flex-wrap">\t\t<span v-if="selected.length < 1" class="selected-item" style="background: none;">\t\t  <span class="uk-text-meta">Select {{name}}...</span>\t\t</span>\t\t<span v-if="selected.length > 0" v-for="select in selected" class="selected-item">\t\t  <template v-for="option in options">\t\t   <div v-if="option.name == select">\t\t   \t{{option.label}}\t\t\t<a class="uk-margin-small-left" href="#" @click="removeSelected(select,selected)">x</a>\t\t   </div>\t\t  </template>\t\t</span>\t  </div>\t</div>\t<div class="uk-dropdown wpteams-no-after a2020-available-container " uk-dropdown="pos:bottom-justify;mode:click;offset:10;">\t  <div class="uk-inline uk-width-1-1 wpteams-border uk-margin-small-bottom">\t\t<span class="uk-form-icon" uk-icon="icon: search" style="\tleft: -8px;"></span>\t\t<input class="uk-input uk-search-input " type="text" style="background: none;border:none;" \t\t:placeholder="placeholder" v-model="thisSearchInput">\t  </div>\t  <div class="">\t\t<template v-for="option in options">\t\t  <span  class="available-item" \t\t  @click="addSelected(option.name, selected)" \t\t  v-if="ifSelected(option.name, selected) && ifInSearch(option.name, thisSearchInput)" \t\t  style="cursor: pointer">\t\t\t{{option.label}}\t\t  </span>\t\t</template>\t  </div>\t</div>\t  '}),contentPageApp.component("a2020-checkbox",{props:{themodel:Array,thevalue:Number},data:function(){return{}},methods:{isOn(){return this.themodel.includes(this.thevalue)}},template:'{{themodel}}<div class="a2020-checkbox uk-border-rounded a2020-border all" :class="{\'checked\' : isOn()}" >      <span class="material-icons-outlined">done</span>      <input type="checkbox" v-model="themodel" :value="thevalue" style="opacity: 1 !important;">    </div>    '}),contentPageApp.component("folder-template",{props:{folder:Object,open:Array,current:Array},data:function(){return{currentFolderObject:[],dragCounter:0}},methods:{isIn(e){return this.open.includes(e)},isActive(e){return this.current.includes(e)},folderToggle(e){const t=this.open.indexOf(e);t>-1?options=this.open.splice(t,1):this.open.push(e)},makeActive(e,t){t[0]=e.id},editFolder(e){this.$parent.editFolder(e)},moveFolder(e,t){self=this,this.dragCounter=0,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_move_folder",security:a2020_content_ajax.security,folderiD:e,destinationId:t},success:function(e){if(data=JSON.parse(e),!data.error)return UIkit.notification(data.message,{pos:"bottom-left",status:"succes"}),self.refreshFolders();UIkit.notification(data.error,{pos:"bottom-left",status:"danger"})}})},moveContentToFolder(e,t){self=this,this.dragCounter=0,jQuery.ajax({url:a2020_content_ajax.ajax_url,type:"post",data:{action:"a2020_move_content_to_folder",security:a2020_content_ajax.security,contentID:e,destinationId:t},success:function(e){data=JSON.parse(e),data.error?UIkit.notification(data.error,{pos:"bottom-left",status:"danger"}):(UIkit.notification(data.message,{pos:"bottom-left",status:"succes"}),self.$root.getFiles(),self.$root.getFolders())}})},refreshFolders(){this.$root.getFolders()},startFolderDrag(e,t){e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("itemID",t.id),e.dataTransfer.setData("type","folder"),jQuery("#a2020-folder-template").show()},dropInfolder(e,t){this.dragCounter=0;var a=e.dataTransfer.getData("itemID"),s=e.dataTransfer.getData("type");"folder"==s&&this.moveFolder(a,t.id),"content"==s&&this.moveContentToFolder(a,JSON.parse(t.id)),jQuery(".valid_drop").removeClass("valid_drop"),jQuery("#a2020-folder-template").hide()},addDropClass(e,t){e.preventDefault(),target=e.target,this.dragCounter++,jQuery(target).hasClass("folder_block")?jQuery(target).addClass("valid_drop"):jQuery(target).closest(".folder_block").addClass("valid_drop")},removeDropClass(e,t){e.preventDefault(),target=e.target,this.dragCounter--,0==this.dragCounter&&(jQuery(target).hasClass("folder_block")?jQuery(target).removeClass("valid_drop"):jQuery(target).closest(".folder_block").removeClass("valid_drop"))}},template:'<div class="a2020-folder-component " :data-folder-id="folder.id">      <div class="uk-flex uk-flex-middle folder_block" draggable="true"      @dragstart="startFolderDrag($event,folder)"      @drop="dropInfolder($event, folder)"       @dragenter="addDropClass($event, folder)"      @dragleave="removeDropClass($event, folder)"      @dragover.prevent      @dragenter.prevent       :class="[{\'folder_open\' : isIn(folder.id)}, {\'active-folder\' : isActive(folder.id)} ]">        <span class="material-icons-outlined uk-text-muted folderChevron" :class="{\'nosub\' : !folder.hasOwnProperty(\'subs\')}" @click="folderToggle(folder.id)">          chevron_right        </span>        <span class="uk-flex uk-flex-middle folder-click" @click="makeActive(folder,current)">          <span class="material-icons  uk-margin-small-right " :style="{\'color\': folder.color}">folder</span>          <span class=" uk-text-bold">{{folder.title}}</span>        </span>        <span class="material-icons  uk-margin-small-left a2020-folder-edit"  @click="editFolder(folder)">edit</span>        <span class="uk-text-muted uk-text-bold a2020-folder-count">{{folder.count}}</span>      </div>      <template v-if="folder.subs" >        <div class="a2020-folder-sub" v-if="isIn(folder.id)">          <template v-for="subfolder in folder.subs">            <folder-template :folder="subfolder" :open="open" :current="current" ></folder-template>          </template>        </div>      </template>    </div>    '}),contentPageApp.mount("#a2020-content-app");